# BSPED Paediatric DKA Calculator

A web application for generating individualised versions of the **integrated care pathway for the management of children and young people under the age of 18 years with Diabetic Ketoacidosis** (2021) in line with [BSPED guidance](https://www.bsped.org.uk/clinical-resources/bsped-dka-guidelines/).

The BSPED Paediatric DKA Calculator is registered as a medical device with the MHRA.

All patient identifiable data is processed on the client device. Only anonymised data is transmitted to the server. Exception: postcode is transmitted (encrypted) to the server and used to derive the Index of Multiple Deprivation (IMD) decile, then immediately deleted and is not stored. See the [privacy policy](https://dka-calculator.co.uk/privacy-policy).

## Client application

The client is a single page application served from `https://dka-calculator.co.uk`. It is designed using the Vue 3 JavaScript framework (Composition API). The client application is found in the repository under `src/`. The dependencies are listed in `package.json`. On deployment the application is minified using a build step to improve performance at runtime.

### Views structure

The view files are single-file components (SFCs). The primary view is `src/App.vue` which adds the header and footer components from `src/components/` around the router-view. The views shown by the router-view are found in `src/views/`. The user progression is generally linear:

1. Start / welcome `Start.vue`
2. Legal disclaimer `FormDisclaimer.vue`
3. Patient details `FormPatientDetails.vue`
4. Clinical details `FormClinicalDetails.vue`
5. Weight safety limit override confirmation `FormOverrideConfirm.vue` (only shown if applicable)
6. Audit details `FormAuditDetails.vue`
7. Generating care pathway `GenerateProtocol.vue`

A separate progression occurs for retrospective updates to the audit data:

1. Start / welcome `Start.vue`
2. Enter data for the update `Update.vue`
3. Submit data `SubmitUpdate.vue`

A separate page exists for calculation of corrected sodium and effective osmolality:

1. Corrected sodium and effective osmolality calculator `SodiumOsmo.vue`

A privacy policy page `PrivacyPolicy.vue` can be accessed outside the usual linear flow.

### Data handling

Data stores are located in `src/assets/`. The data entered is handled by `data.js` which includes the client-side validation checks for the data.

Once the final step of the form is reached the data is transmitted using the method from `api.js` which also deposits the API response into `data.js`.

The PDF care pathway is generated by the `webWorker.js` method which uses `docDef.js`, `imageStore.js`, `data.js` and `config.js` to build the document definition required by the PDFmake library.

## API

The API is served from `https://api.dka-calculator.co.uk/` which is in a separate repository at <https://github.com/dan-leach/dka-calculator-api>. The various functions of the API include validating and performing calculations on the input variables, generating unique episode IDs, inserting audit variables into the SQL database and returning the calculations and episode IDs to the client.
